<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Créateur de Personnage par Abérion</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cardo&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background: url('https://www.transparenttextures.com/patterns/cream-dust.png');
      font-family: 'Cardo', serif;
      color: #2c1c0c;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background-color: #e8d2ae;
      border: 3px double #6a4e2a;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    h1 {
      text-align: center;
      font-family: 'Cinzel', serif;
      font-size: 2.8rem;
      border-bottom: 2px solid #6a4e2a;
      padding-bottom: 0.5rem;
      margin-bottom: 2rem;
      color: #4b2e15;
    }
    #points-counter {
      text-align: center;
      font-size: 1.3rem;
      margin-bottom: 2rem;
      color: #5a3921;
      font-weight: bold;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
    }
    .form-group {
      flex: 1 1 45%;
      min-width: 250px;
    }
    .form-group.wide {
      flex: 1 1 100%;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 0.3rem;
      font-family: 'Cinzel', serif;
      color: #3c2814;
    }
    input, select, textarea {
      padding: 0.4rem;
      border: 1px solid #a88e5d;
      border-radius: 4px;
      background-color: #fefdf8;
      font-family: 'Cardo', serif;
    }
    input[type="text"] {
      max-width: 300px;
      width: 100%;
      max-length: 20;
    }
    input[type="number"] {
      width: 80px;
      max: 999;
    }
    textarea {
      min-height: 80px;
      width: 100%;
    }
    .section-separator {
      flex: 1 1 100%;
      border-top: 2px dashed #b49a6d;
      margin: 2rem 0;
    }
    .attributes-block {
      margin-top: 2rem;
    }
    .attributes-block h3 {
      margin-bottom: 0.5rem;
      color: #4d3923;
      border-bottom: 1px dashed #ccb383;
      font-family: 'Cinzel', serif;
    }
    .trio-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background-color: #f0ece3;
      border-radius: 6px;
      border: 1px solid #cbb78e;
    }
    .trio-row .attribute-item {
      flex: 1 1 30%;
    }
    .trio-row .characteristic-result {
      flex: 1 1 100%;
      font-style: italic;
      margin-top: 0.3rem;
      text-align: right;
      font-weight: bold;
      color: #4a321a;
    }
    button {
      margin-top: 2rem;
      background-color: #8d6e41;
      color: white;
      padding: 0.8rem 1.6rem;
      border: none;
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cinzel', serif;
    }
    button:hover {
      background-color: #6d522e;
    }
  </style>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll("input[type='number']");
    const pointsDisplay = document.querySelector("#points-counter strong");
    const genSelect = document.querySelector("select[name='generation']");
    const characteristicOutputs = document.querySelectorAll(".characteristic-result");

    const karmaInput = document.querySelector("input[name='karma']");
    const faiblesseInput = document.querySelector("input[name='faiblesse']");
    const alliesInput = document.querySelector("input[name='allies']");
    const ennemisInput = document.querySelector("input[name='ennemis']");
    const contributionsInput = document.querySelector("input[name='contributions']");

    function getGenerationPoints() {
      const val = genSelect.value;
      if (val === "1") return 800;
      if (val === "2") return 600;
      return 400;
    }

    function calcAverage(vals) {
      const numbers = vals.map(id => parseInt(document.querySelector(`[name='${id}']`).value || 20));
      const sum = numbers.reduce((a, b) => a + b, 0);
      return Math.floor(sum / numbers.length);
    }

    function update() {
      let total = 0;
      inputs.forEach(input => {
        if (!input.name.match(/karma|allies|ennemis|contributions|age/)) {
          const val = parseInt(input.value || 20);
          total += val - 20;
        }
      });

      let bonus = 0;
      const karma = parseInt(karmaInput.value || 0);
      if (karma < 0) bonus += Math.abs(karma) * 2;
      if (karma > 0) bonus -= karma * 2;

      const allies = parseInt(alliesInput.value || 0);
      const ennemis = parseInt(ennemisInput.value || 0);
      bonus -= allies;
      bonus += ennemis;

      const contributions = parseInt(contributionsInput.value || 0);
      bonus += contributions * 15;

      const faiblesse = faiblesseInput.value.trim();
      if (faiblesse.length > 0) bonus += 15;

      const remaining = getGenerationPoints() - total + bonus;
      pointsDisplay.textContent = remaining;

      const characteristics = [
        { name: "PHYSIQUE", ids: ["force", "dexterite", "reflexe"] },
        { name: "ENDURANCE", ids: ["adaptation", "regeneration", "resistance"] },
        { name: "PSYCHE", ids: ["intelligence", "concentration", "volonte"] },
        { name: "PERCEPTION", ids: ["sens", "sixiemesens", "empathie"] },
        { name: "CHARISME", ids: ["eloquence", "intimidation", "apparence"] },
      ];

      characteristicOutputs.forEach((el, idx) => {
        const score = calcAverage(characteristics[idx].ids);
        el.textContent = `${characteristics[idx].name} = ${score}`;
      });
    }

    document.querySelectorAll("input, select").forEach(el => el.addEventListener("input", update));
    update();
  });
</script>
</head>
<body>
  <div class="container">
        <h1>Créateur de Personnage par Abérion</h1>
    <div class="form-group wide" style="text-align:center; margin-bottom: 1rem;">
      <label for="generation">Choix de la génération :</label>
      <select name="generation" id="generation">
        <option value="1">1ère génération (800 pts)</option>
        <option value="2" selected>2ème génération (600 pts)</option>
        <option value="3">3ème génération (400 pts)</option>
       </select>
    <div id="points-counter">Points de création restants : <strong>...</strong></div>
      <div class="container" id="fiche-container">
    <div style="text-align:center; margin-bottom: 1.5rem;">
  <h2>Les Fanzines d'Ambre</h2>
    <form>
      <div class="form-group"><label>Nom du personnage</label><input type="text" name="nom"></div>
      <div class="form-group"><label>Âge</label><input type="number" name="age" min="10" max="60"></div>
      <div class="form-group"><label>Origine</label><input type="text" name="origine"></div>
      <div class="form-group"><label>Symbole personnel</label><input type="text" name="symbole"></div>
      <div class="form-group"><label>Couleur des yeux</label><input type="text" name="yeux"></div>
      <div class="form-group"><label>Couleur des cheveux</label><input type="text" name="cheveux"></div>
      <div class="form-group"><label>Karma (-15 à +15)</label><input type="number" name="karma" min="-15" max="15"></div>
      <div class="form-group"><label>Faiblesse (optionnelle)</label><input type="text" name="faiblesse"></div>
      <div class="form-group"><label>Alliés (0 à 15)</label><input type="number" name="allies" min="0" max="15"></div>
      <div class="form-group"><label>Ennemis (0 à 15)</label><input type="number" name="ennemis" min="0" max="15"></div>
      <div class="form-group"><label>Contributions (0 à 2)</label><input type="number" name="contributions" min="0" max="2"></div>
      <div class="form-group wide"><label>Artefact personnel lié</label><textarea name="artefact"></textarea></div>
      <div class="form-group wide"><label>Créature personnelle liée</label><textarea name="creature"></textarea></div>
      <div class="form-group wide"><label>Ombre personnelle liée</label><textarea name="ombre"></textarea></div>
      <div class="form-group wide"><label>Pouvoirs choisis</label><textarea name="pouvoirs"></textarea></div>

      </div>

      <!-- Caractéristiques (inchangé, toujours visibles) -->
      <div class="form-group wide attributes-block">
        <h3>Caractéristiques</h3>
        <div class="trio-row">
          <div class="attribute-item"><label>Force</label><input type="number" name="force" min="20"></div>
          <div class="attribute-item"><label>Dextérité</label><input type="number" name="dexterite" min="20"></div>
          <div class="attribute-item"><label>Réflexe</label><input type="number" name="reflexe" min="20"></div>
          <div class="characteristic-result">PHYSIQUE = ...</div>
        </div>
        <div class="trio-row">
          <div class="attribute-item"><label>Adaptation</label><input type="number" name="adaptation" min="20"></div>
          <div class="attribute-item"><label>Régénération</label><input type="number" name="regeneration" min="20"></div>
          <div class="attribute-item"><label>Résistance</label><input type="number" name="resistance" min="20"></div>
          <div class="characteristic-result">ENDURANCE = ...</div>
        </div>
        <div class="trio-row">
          <div class="attribute-item"><label>Intelligence</label><input type="number" name="intelligence" min="20"></div>
          <div class="attribute-item"><label>Concentration</label><input type="number" name="concentration" min="20"></div>
          <div class="attribute-item"><label>Volonté</label><input type="number" name="volonte" min="20"></div>
          <div class="characteristic-result">PSYCHE = ...</div>
        </div>
        <div class="trio-row">
          <div class="attribute-item"><label>Sens</label><input type="number" name="sens" min="20"></div>
          <div class="attribute-item"><label>Sixième Sens</label><input type="number" name="sixiemesens" min="20"></div>
          <div class="attribute-item"><label>Empathie</label><input type="number" name="empathie" min="20"></div>
          <div class="characteristic-result">PERCEPTION = ...</div>
        </div>
        <div class="trio-row">
          <div class="attribute-item"><label>Éloquence</label><input type="number" name="eloquence" min="20"></div>
          <div class="attribute-item"><label>Intimidation</label><input type="number" name="intimidation" min="20"></div>
          <div class="attribute-item"><label>Apparence</label><input type="number" name="apparence" min="20"></div>
          <div class="characteristic-result">CHARISME = ...</div>
        </div>
      </div>

      <div class="form-group wide" style="text-align:center;">
        <button type="submit">Générer la fiche PDF</button>
      </div>
    </form>
  </div>
  
  <script>
    async function generatePDF() {
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

      // PAGE 1 : fiche perso
      const fiche = document.querySelector("#fiche-container");
      await doc.html(fiche, {
        x: 20,
        y: 20,
        width: 555,
        windowWidth: 1000,
        html2canvas: { scale: 0.6 },
        callback: function (doc) {
          // PAGE 2 : pouvoirs choisis uniquement
          const pouvoirs = document.querySelector("textarea[name='pouvoirs']")?.value || "(Aucun pouvoir indiqué)";
          doc.addPage();
          doc.setFont("times", "bold");
          doc.setFontSize(20);
          doc.text("Pouvoirs Choisis", 40, 60);

          doc.setFont("times", "normal");
          doc.setFontSize(12);
          const lignes = doc.splitTextToSize(pouvoirs, 520);
          doc.text(lignes, 40, 100);

          doc.save("Fiche_Amberion.pdf");
        }
      });
    }
  </script>
  <script>
    async function generatePDF() {
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

      // PAGE 1 : fiche perso
      const fiche = document.querySelector("#fiche-container");
      await doc.html(fiche, {
        x: 20,
        y: 20,
        width: 555,
        windowWidth: 1000,
        html2canvas: { scale: 0.6 },
        callback: function (doc) {
          // PAGE 2 : pouvoirs choisis uniquement
          const pouvoirs = document.querySelector("textarea[name='pouvoirs']")?.value || "(Aucun pouvoir indiqué)";
          doc.addPage();
          doc.setFont("times", "bold");
          doc.setFontSize(20);
          doc.text("Pouvoirs Choisis", 40, 60);

          doc.setFont("times", "normal");
          doc.setFontSize(12);
          const lignes = doc.splitTextToSize(pouvoirs, 520);
          doc.text(lignes, 40, 100);

          doc.save("Fiche_Amberion.pdf");
        }
      });
    }
  </script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll("input[type='number']");
    const pointsDisplay = document.querySelector("#points-counter strong");
    const genSelect = document.querySelector("select[name='generation']");
    const characteristicOutputs = document.querySelectorAll(".characteristic-result");

    const karmaInput = document.querySelector("input[name='karma']");
    const faiblesseInput = document.querySelector("input[name='faiblesse']");
    const alliesInput = document.querySelector("input[name='allies']");
    const ennemisInput = document.querySelector("input[name='ennemis']");
    const contributionsInput = document.querySelector("input[name='contributions']");

    function getGenerationPoints() {
      const val = genSelect.value;
      if (val === "1") return 800;
      if (val === "2") return 600;
      return 400;
    }

    function calcAverage(vals) {
      const numbers = vals.map(id => parseInt(document.querySelector(`[name='${id}']`).value || 20));
      const sum = numbers.reduce((a, b) => a + b, 0);
      return Math.floor(sum / numbers.length);
    }

    function update() {
      let total = 0;
      inputs.forEach(input => {
        if (!input.name.match(/karma|allies|ennemis|contributions|age/)) {
          const val = parseInt(input.value || 20);
          total += val - 20;
        }
      });

      let bonus = 0;
      const karma = parseInt(karmaInput.value || 0);
      if (karma < 0) bonus += Math.abs(karma) * 2;
      if (karma > 0) bonus -= karma * 2;

      const allies = parseInt(alliesInput.value || 0);
      const ennemis = parseInt(ennemisInput.value || 0);
      bonus -= allies;
      bonus += ennemis;

      const contributions = parseInt(contributionsInput.value || 0);
      bonus += contributions * 15;

      const faiblesse = faiblesseInput.value.trim();
      if (faiblesse.length > 0) bonus += 15;

      const remaining = getGenerationPoints() - total + bonus;
      pointsDisplay.textContent = remaining;

      const characteristics = [
        { name: "PHYSIQUE", ids: ["force", "dexterite", "reflexe"] },
        { name: "ENDURANCE", ids: ["adaptation", "regeneration", "resistance"] },
        { name: "PSYCHE", ids: ["intelligence", "concentration", "volonte"] },
        { name: "PERCEPTION", ids: ["sens", "sixiemesens", "empathie"] },
        { name: "CHARISME", ids: ["eloquence", "intimidation", "apparence"] },
      ];

      characteristicOutputs.forEach((el, idx) => {
        const score = calcAverage(characteristics[idx].ids);
        el.textContent = `${characteristics[idx].name} = ${score}`;
      });
    }

    document.querySelectorAll("input, select").forEach(el => el.addEventListener("input", update));
    update();
  });
</script>
</body>
</html>
